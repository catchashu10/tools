#!/usr/bin/env bash
# Capture tmux session context for AI assistance
# Usage: capture [session_name]
#   No args: captures current session
#   With arg: captures specified session

TARGET_SESSION="$1"
TMUX_SESSIONS=$(tmux list-sessions -F '#S' 2>/dev/null)

# If session specified, verify it exists
if [ -n "$TARGET_SESSION" ]; then
    if echo "$TMUX_SESSIONS" | grep -q "^${TARGET_SESSION}$"; then
        echo "Capturing Tmux session: $TARGET_SESSION"
        TMUX_TARGET_SESSION="$TARGET_SESSION" tmux-capture
        exit $?
    else
        echo "Session '$TARGET_SESSION' not found"
        echo ""
        if [ -n "$TMUX_SESSIONS" ]; then
            echo "Available sessions:"
            for s in $TMUX_SESSIONS; do
                echo "  capture $s"
            done
        else
            echo "No active tmux sessions. Start one with:"
            echo "  tmux new -s main"
        fi
        exit 1
    fi
fi

# No session specified - use current
if [ -n "$TMUX" ]; then
    exec tmux-capture
else
    # Not in tmux - list available sessions
    echo "Not inside a tmux session"
    echo ""
    if [ -n "$TMUX_SESSIONS" ]; then
        echo "Available sessions to capture:"
        for s in $TMUX_SESSIONS; do
            echo "  capture $s"
        done
    else
        echo "No active tmux sessions. Start one with:"
        echo "  tmux new -s main"
    fi
    exit 1
fi
